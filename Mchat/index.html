<html lang="zh-CN">
<head>
<title>Mchat</title>
<meta charset="utf-8">
<meta name="referrer" content="no-referrer"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<link rel="icon" href="../favicon.ico"/>
<link rel="stylesheet" href="../start/index.css"/>
<link rel="stylesheet" href="../start/mdui/css/mdui.min.css"/>
<link rel="stylesheet" href="../start/bootstrap/css/bootstrap.min.css"/>
<script src="../start/origin.js"></script>
<script src="../start/mdui/js/mdui.min.js"></script>
<script src="../start/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../start/marked.js"></script>
</head>
<body>
<div id="root"></div>
<script>
var $ = mdui.$;
function getCookieValue(cookieName) {
var cookies = document.cookie.split(';');
for (var i = 0; i < cookies.length; i++) {
var cookie = cookies[i].trim();
if (cookie.indexOf(cookieName + '=') === 0) {
return cookie.substring(cookieName.length + 1);
}
}
return null;
}
var username=getCookieValue('username');
var password=getCookieValue('password');
$.ajax({
url: 'https://s.jixiejidiguan.top/Api/Mchat/login.php?L',
method: 'POST',
dataType: "json",  
data: {
username: username,
password: password
},
success: function (data) {
console.log(data.message);
if(data.message==="登录成功！"){
var hash=window.location.hash;
var truncatedUrl=hash.replace('#group_id=', '');
if(hash.toString().indexOf('#group_id=')!==-1){
$.ajax({
url: 'https://s.jixiejidiguan.top/Api/Mchat/content.php?group_id='+truncatedUrl,
method: 'POST',
dataType: "json",  
data: {
username: username,
password: password
},
success: function (data_t) {
$.ajax({url: 'https://s.jixiejidiguan.top/Api/Mchat/content.php',method: 'POST',dataType: "json",  data: {username: username,password: password},success: function (data_e) {
$.each(data_e.data,function(i,n){if(n.group_id===truncatedUrl){var Group_Name=n.Group_Name;$('.navbar-brand').text(Group_Name);}});
}
});
var html=`
<style>.bg-body-tertiary-text{width: auto;display: flex;}.bg-body-tertiary-texts {width: auto;display: flex;flex-direction: row-reverse;}</style>
<div class="container">
<nav class="navbar navbar-expand-lg bg-body-tertiary">
<div class="container-fluid">
<a href="/Mchat" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">keyboard_arrow_left</i></a>
<span class="mdui-float-right navbar-brand"></span>
</div>
</nav>
<div class="mdui-appbar-with-toolbar"></div>
<ul class="mdui-list mb-3">`;
$.each(data_t.data,function(i,n){
if(data.data.uid===n.uid){
html+=`<li class="bg-body-tertiary-texts mb-2"></li>
<li class="bg-body-tertiary-texts breadcrumb-item active">`+n.nickname+`</li>
<div class="bg-body-tertiary-texts">
<span class="shadow-sm bg-body-secondary text-break font-monospace p-2">`+marked(n.informative_text)+`</span>
</div>
<span class="bg-body-tertiary-texts badge rounded-pill text-body-tertiary">`+n.Group_Introduction+`</span>
`;
}else{
html+=`<li class="bg-body-tertiary-text mb-2"></li>
<li class="bg-body-tertiary-text breadcrumb-item active">`+n.nickname+`</li>
<div class="bg-body-tertiary-text">
<span class="shadow-sm bg-body-secondary text-break font-monospace p-2">`+marked(n.informative_text)+`</span>
</div>
<span class="bg-body-tertiary-text badge rounded-pill text-body-tertiary">`+n.Group_Introduction+`</span>
`;
}
});
html+=`</ul>
<div class="mb-5"</div>
<div class="bg-body-tertiary fixed-bottom container"><div class="hstack gap-3 mb-1">
<textarea id="text" class="mdui-textfield mdui-textfield-input me-auto" rows="1" placeholder=""></textarea>
<div class="vr"></div>
<button id="Send" class="btn mdui-btn mdui-btn-raised text-bg-primary">发送</button>
</div></div>
</div>`;
$('#root').append(html);
function startLoop(truncatedUrl) {
$.ajax({url: 'https://s.jixiejidiguan.top/Api/Mchat/content.php?group_id='+truncatedUrl,method: 'POST',dataType: "json",data:{username: username,password: password},success: function (data_y) {
$.each(data_y.data,function(i,n){
var rounded_pill=$('.rounded-pill').eq(-1).text();
var rounded_pills=data_y.data[data_y.data.length - 1];
if(rounded_pill==rounded_pills.Group_Introduction){}else{
if(data.data.uid===rounded_pills.uid){
var str=`<li class="bg-body-tertiary-texts mb-2"></li>
<li class="bg-body-tertiary-texts breadcrumb-item active">`+rounded_pills.nickname+`</li>
<div class="bg-body-tertiary-texts">
<span class="shadow-sm bg-body-secondary text-break font-monospace p-2">`+marked(rounded_pills.informative_text)+`</span>
</div>
<span class="bg-body-tertiary-texts badge rounded-pill text-body-tertiary">`+rounded_pills.Group_Introduction+`</span>
`;
$('.mdui-list').append(str);
}else{
var str=`<li class="bg-body-tertiary-text mb-2"></li>
<li class="bg-body-tertiary-text breadcrumb-item active">`+rounded_pills.nickname+`</li>
<div class="bg-body-tertiary-text">
<span class="shadow-sm bg-body-secondary text-break font-monospace p-2">`+marked(rounded_pills.informative_text)+`</span>
</div>
<span class="bg-body-tertiary-text badge rounded-pill text-body-tertiary">`+rounded_pills.Group_Introduction+`</span>
`;
$('.mdui-list').append(str);
}
}
});
}
});
setTimeout(function() {
startLoop(truncatedUrl);
}, 3000);
}
setInterval(startLoop(truncatedUrl), 1500);


$('#Send').on('click', function (e) {
var datatext= $('#text').val();
$.ajax({url: 'https://s.jixiejidiguan.top/Api/Mchat/content.php?group_id='+truncatedUrl,method: 'POST',dataType: "json",  data: {username: username,password: password,content: datatext},success: function (data_u) {
console.log(data_u.message);    
}
});
console.log(datatext);
$('#text').val('');
});
}
});
}else{
$.ajax({
url: 'https://s.jixiejidiguan.top/Api/Mchat/content.php',
method: 'POST',
dataType: "json",  
data: {
username: username,
password: password
},
success: function (data) {
console.log(data.message);
var html=`<div class="container"><ul class="mdui-list">`;
$.each(data.data,function(i,n){
html+=`<a href="#group_id=`+n.group_id+`"><li class="mdui-list-item mdui-ripple">
<div class="mdui-list-item-avatar"><img src="`+n.Group_avatar+`"/></div>
<div class="mdui-list-item-content">
<div class="mdui-list-item-title">`+n.Group_Name+`</div>
<div class="mdui-list-item-text mdui-list-item-one-line">`+n.Group_Introduction+`</div>
</div>
</li><li class="mdui-divider-inset mdui-m-y-0"></li></a>`;
});
html+=`</ul></div>`;
$('#root').append(html);
$('a').on('click', function (e) {
window.location.href = $(this).attr('href');
location.reload();
});
}
});
}
console.log(truncatedUrl);
}else{
var html=`<div class="container mdui-appbar-with-toolbar mdui-appbar-with-tab">
<div class="row text-center fs-1"><div class="col-sm-5 col-sm-4 d-grid gap-2 mx-auto">
<div class="mb-5"></div>
<p class="text-center font-monospace">未登录？<a href="Login.html">去登录</a></p>
</div></div>
</div>`;
$('#root').append(html);
}
return;
}
});
</script>
</body>
</html>