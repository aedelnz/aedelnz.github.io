<html lang="zh-CN">
<head>
<title>Mchat</title>
<meta charset="utf-8" />
<meta name="referrer" content="no-referrer" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<link rel="icon" href="../favicon.ico?v=1.0000" type="image/png" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" integrity="sha512-ZnR2wlLbSbr8/c9AgLg3jQPAattCUImNsae6NHYnS9KrIwRdcY9DxFotXhNAKIKbAXlRnujIqUWoXXwqyFOeIQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0-alpha3/css/bootstrap.min.css" integrity="sha512-iGjGmwIm1UHNaSuwiNFfB3+HpzT/YLJMiYPKzlQEVpT6FWi5rfpbyrBuTPseScOCWBkRtsrRIbrTzJpQ02IaLA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdui/1.0.2/css/mdui.min.css" integrity="sha512-Hh2syGXSuZabqBNcdvPiGo67ASyKhlKTZV9lLOmJp10qZ1v8/YPeuZBoOh0WmS/UPwWtRzQhNJfYyKDAhdGocQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="../start/index.css?v=1.0000" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="../start/origin.js?v=1.0000"></script>
</head>
<body class="mdui-appbar-with-toolbar container container-fluid">
<div class="container container-fluid mdui-appbar mdui-appbar-fixed">
<div class="mdui-toolbar">
<a id="fanhuisu" href="/Mchat" class="mdui-btn mdui-btn-icon">
<i class="mdui-icon material-icons">arrow_back</i>
</a>
<a href="javascript:;" class="mdui-typo-title">Mchat</a>
<div class="mdui-toolbar-spacer"></div>
<button type="button" id="staticBackdrop1" class="btn btn-sm mdui-btn mdui-btn-icon" data-bs-toggle="modal" data-bs-target="#staticBackdrop"><i class="mdui-icon material-icons">healing</i></button>
<button type="button" id="clearCookie" class="btn btn-sm mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">exit_to_app</i></button>
</div>
</div>

<div id="tanchuang"></div>
<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h1 class="modal-title fs-5" id="staticBackdropLabel">个人信息</h1>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
<div class="mb-3">
  <label class="form-label">uid：</label>
  <span id="uidttts"></span>
</div>
<div class="mb-3">
  <label class="form-label">账号：</label>
  <span id="usernamessh"></span>
</div>
<div class="mb-3">
  <label class="form-label">注册时间：</label>
  <span id="zcsjsskk"></span>
</div>
<form id="Content-modification">
<div class="mb-3">
  <label class="form-label">昵称</label>
  <input type="text" class="form-control" id="name">
</div>
<button type="submit" class="btn btn-primary mdui-float-right">修改</button>
</form>
<form id="Content-modifications">
<div class="mb-3">
  <label class="form-label">密码</label>
  <input type="text" class="form-control" id="pass">
</div>
<button type="submit" class="btn btn-primary mdui-float-right">修改</button>
</form>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
</div>
</div>
</div>
</div>

<div id="visually-hidden">
<div id="group_id"></div>
</div>

<div id="visibility">
<style>
.mdui-list-items {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: center;
    -ms-flex-align: center;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    min-height: 48px;
    padding: 0 16px;
    text-decoration: none;
    cursor: pointer;
    -webkit-transition: background-color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transition: background-color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
span.card {
width: max-content;
}
div.mdui-list-item-text.x {
display: flex;
flex-direction: row-reverse;
}
</style>
<div id="group_list" style="bottom:60px;"></div>
<div class="fixed-bottom container container-fluid">
<div id="fasongxinxitishi" class="p-1"></div>
<div id="tianxie" class="d-none bg-white text-dark">
<div class="mdui-float-right p-1">
<button id="tianxienr" class="btn" type="submit"><i class="mdui-icon material-icons">arrow_downward</i></button>
</div>
<div class="mdui-textfield p-2">
<textarea class="mdui-textfield-input" id="tianxietext" rows="4" placeholder="输入发送内容"></textarea>
</div>
</div>

<div id="jiandanbjk" class="row align-items-start bg-white text-dark sticky-bottom">
<div class="col-8">
<div class="float-start mdui-float-left p-1" style="width: 100%">
<input type="text" class="mdui-textfield-input" id="xinxitext" placeholder="输入发送内容">
</div>
</div>
<div class="col-4">
<div class="mdui-float-right p-1" style="display: flex;flex-direction: row;">
<button id="tuozhan" class="btn" type="submit"><i class="mdui-icon material-icons">aspect_ratio</i></button>
<button id="fasongxinxi" class="btn btn-primary" type="submit">发送</button>
</div>
</div>
</div>

</div>
</div>
<script>
$('#clearCookie').click(function() {
$.removeCookie('_key', { path: '/' });
location.reload();
});

var cookieData = $.cookie("_key");
if (cookieData) {
var parsedData = JSON.parse(cookieData);
$.post("https://s.jixiejidiguan.top/Api/Mchat/login.php?L", {username: parsedData.username, password: parsedData.password}, function(data) {
if(data.message==='登录成功！') {
$(document).ready(function() {
$('#tanchuang').html('<div class="alert alert-secondary" role="alert">'+data.message+'</div>');
setTimeout(function() {
$("#tanchuang").hide();
}, 1000);
});
$('#staticBackdrop1').click(function() {
$('#uidttts').text(data.data.uid);
$('#usernamessh').text(data.data.username);
$('#pass').val(data.data.password);
$('#name').val(data.data.nickname);
$('#zcsjsskk').text(data.data.registration_time);
});
var hash = window.location.hash;
var truncatedUrl = hash.replace('#group_id=', '');
if (hash.toString().indexOf('#group_id=') !== -1) {
$("#visually-hidden").addClass("visually-hidden");

function listxxt(truncatedUrl){
$.post('https://s.jixiejidiguan.top/Api/Mchat/content.php?group_id='+truncatedUrl, {username: parsedData.username, password: parsedData.password}, function(data_g) {
if(data_g.message==='查询成功！'){
var shijian = data_g.data[data_g.data.length - 1];
localStorage.setItem('time', shijian.Group_Introduction);
var str=`<ul id="listtyu" class="mdui-list mb-4">`;
$.each(data_g.data,function(i,n){
var informative_text = n.informative_text.replace(/\n/g, "<br>");
if(n.uid==parsedData.uid){
str+=`<li class="mdui-list-items">
<i style="min-width: 40px;max-width: 40px;line-height: 40px;"></i>
<div class="mdui-list-item-content">
<div class="mdui-list-item-title mdui-text-right"><span style="font-size: 1px;">`+n.uid+`</span><br>`+n.nickname+`</div>
<div class="mdui-list-item-text x">
<span class="p-1 bg-white card text-dark fw-bold" style="border-radius: 6px;">`+informative_text+`</span>
</div>
<div class="mdui-typo-caption-opacity mdui-text-right">`+n.Group_Introduction+`</div>
</div>
<i class="mdui-list-item-avatar mdui-icon material-icons">account_box</i>
</li>
`;
}else{
str+=`<li class="mdui-list-items">
<i class="mdui-list-item-avatar mdui-icon material-icons">account_circle</i>
<div class="mdui-list-item-content">
<div class="mdui-list-item-title"><span style="font-size: 1px;">`+n.uid+`</span><br>`+n.nickname+`</div>
<div class="mdui-list-item-text">
<span class="p-1 bg-white card text-dark fw-bold" style="border-radius: 6px;">`+informative_text+`</span>
</div>
<div class="mdui-typo-caption-opacity">`+n.Group_Introduction+`</div>
</div>
<i style="min-width: 40px;max-width: 40px;line-height: 40px;"></i>
</li>
`;
}
});
str+='</ul><div id="xjdjdkdk" class="mb-5"></div>';
$("#group_list").append(str);
}
});
}
listxxt(truncatedUrl);


$(document).ready(function() {
function startLoop(truncatedUrl) {
$.post('https://s.jixiejidiguan.top/Api/Mchat/content.php?group_id='+truncatedUrl, {username: parsedData.username, password: parsedData.password}, function(data_g) {
if(data_g.message==='查询成功！'){
var wltime = data_g.data[data_g.data.length - 1];
var shijianyz = localStorage.getItem('time');
if(shijianyz===wltime.Group_Introduction){
}else{
var informative_textt = wltime.informative_text.replace(/\n/g, "<br>");
localStorage.setItem('time', wltime.Group_Introduction);
if(wltime.uid===parsedData.uid){
var listadd=`<li class="mdui-list-items">
<i style="min-width: 40px;max-width: 40px;line-height: 40px;"></i>
<div class="mdui-list-item-content">
<div class="mdui-list-item-title mdui-text-right"><span style="font-size: 1px;">`+wltime.uid+`</span><br>`+wltime.nickname+`</div>
<div class="mdui-list-item-text x">
<span class="p-1 bg-white card text-dark fw-bold" style="border-radius: 6px;">`+informative_textt+`</span>
</div>
<div class="mdui-typo-caption-opacity mdui-text-right">`+wltime.Group_Introduction+`</div>
</div>
<i class="mdui-list-item-avatar mdui-icon material-icons">account_box</i>
</li>
`;
}else{
var listadd = `<li class="mdui-list-items">
<i class="mdui-list-item-avatar mdui-icon material-icons">account_circle</i>
<div class="mdui-list-item-content">
<div class="mdui-list-item-title"><span style="font-size: 1px;">`+wltime.uid+`</span><br>`+wltime.nickname+`</div>
<div class="mdui-list-item-text">
<span class="p-1 bg-white card text-dark fw-bold" style="border-radius: 6px;">`+informative_textt+`</span>
</div>
<div class="mdui-typo-caption-opacity">`+wltime.Group_Introduction+`</div>
</div>
<i style="min-width: 40px;max-width: 40px;line-height: 40px;"></i>
</li>`;
}

$("#listtyu").append(listadd);
}
}
});
$('html, body').animate({ scrollTop: $(document).height() }, 10);
setTimeout(startLoop, 1000);
}
startLoop();
});

$('#tuozhan').click(function() {
$("#tianxie").removeClass("d-none");
$("#jiandanbjk").addClass("d-none");
var xinxitext = $("#xinxitext").val(); 
var xinxitextt = tianxietext.replace(/\n/g, "\\n");
$('#tianxietext').val(xinxitextt); 
});

$('#tianxienr').click(function() {
$("#tianxie").addClass("d-none");
$("#jiandanbjk").removeClass("d-none"); 
var tianxietext = $("#tianxietext").val(); 
var tianxietextt = tianxietext.replace(/\n/g, "\\n");
$('#xinxitext').val(tianxietextt); 
});

$('#fasongxinxi').click(function() {
var fsxinxitext = $("#xinxitext").val(); 
$.post('https://s.jixiejidiguan.top/Api/Mchat/content.php?group_id='+truncatedUrl, {username: parsedData.username, password: parsedData.password, content: fsxinxitext}, function(data) {
$(document).ready(function() {
$("#fasongxinxitishi").text(data.message);
$("#fasongxinxitishi").fadeIn();
setTimeout(function() {
$("#fasongxinxitishi").fadeOut();
}, 1000); // 3秒后关闭内容
});
});
$('#xinxitext').val(''); 
});

} else {
$("#visibility").addClass("visually-hidden");
$("#fanhuisu").addClass("visually-hidden");

$.post('https://s.jixiejidiguan.top/Api/Mchat/content.php', {username: parsedData.username, password: parsedData.password}, function(data_g) {
if(data_g.message==='查询成功！'){
var str=`<ul class="mdui-list">`;
$.each(data_g.data,function(i,n){
$(document).ready(function() {
// 选中链接并绑定点击事件处理程序
$('#a').click(function(event) {
window.location.href = $(this).attr('href'); // 跳转到链接中的地址
location.reload();
});
});
str+=`<a id="a" href="/Mchat/#group_id=`+n.group_id+`">
<li class="mdui-list-item mdui-ripple">
<div class="mdui-list-item-avatar">
<img src="`+n.Group_avatar+`"/>
</div>
<div class="mdui-list-item-content">
<div class="mdui-list-item-title">`+n.Group_Name+`</div>
<div class="mdui-list-item-text mdui-list-item-one-line">
<span class="mdui-text-color-theme-text">`+n.Group_Introduction+`</span>
</div>
</div>
</li>
<li class="mdui-divider-inset mdui-m-y-0"></li>
</a>
`;
});
str+='</ul>';
$("#group_id").append(str);
}
});
}
$('#Content-modification').submit(function(event) {
event.preventDefault(); // 阻止默认的表单提交行为
var name = $('#name').val();
$.post('https://s.jixiejidiguan.top/Api/Mchat/login.php?M', {username: parsedData.username, password: parsedData.password, Pm: pass, Nm: name}, function(data) {
alert(data.message);
location.reload();
});
});
$('#Content-modifications').submit(function(event) {
event.preventDefault(); // 阻止默认的表单提交行为
var pass = $('#pass').val();
$.post('https://s.jixiejidiguan.top/Api/Mchat/login.php?M', {username: parsedData.username, password: parsedData.password, Pm: pass, Nm: name}, function(data) {
alert(data.message);
location.reload();
});
});

} else {
$('#tanchuang').html('<div class="alert alert-secondary" role="alert">'+data.message+'</div>');
window.location.href = 'Login.html';
}
}).fail(function() {
alert("请求失败！");
});
} else {
$('#tanchuang').html('<div class="alert alert-secondary" role="alert">'+cookieData+'</div>');
window.location.href = 'Login.html';
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0-alpha3/js/bootstrap.bundle.min.js" integrity="sha512-vIAkTd3Ary9rwf0lrb9kIipyIkavKpYGnyopBXs6SiLfNSzAvCNvvQvKwBV5Xlag4O8oZpZ5U5n4bHoErGQxjw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdui/1.0.2/js/mdui.min.js" integrity="sha512-LBh0vC8hNru7991yk7vBb3tiBCU41shGOowGRnLqz63KYedvNQOyGOKHnl/pHSRYJ2P45bjzALArvDDHSSc2KA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>
</html>