<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
    <meta name="renderer" content="webkit">
    <meta name="description" content="一个二次元导航站！">
    <title>爱莫能助</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="/root/file/mdui.css">
    <style>
    body{margin:0}
    mdui-top-app-bar,mdui-navigation-drawer,footer{box-shadow:var(--mdui-elevation-level1)}
    .mdui-prose{padding:var(--mdui-typescale-body-small-size)}
    mdui-card{padding:var(--mdui-typescale-label-small-line-height);width:100%}
    .h1{margin-top:var(--mdui-typescale-label-large-line-height);font-size:var(--mdui-typescale-title-large-size);font-weight:var(--mdui-typescale-title-medium-weight);line-height:1;border-left:var(--mdui-typescale-label-small-line-height) solid rgb(var(--mdui-color-primary));padding-left:var(--mdui-typescale-body-medium-size)}


    [class*=row-]{display:flex;flex-wrap:wrap;margin:0 -2px}
    .col{border-radius:var(--mdui-shape-corner-medium);background-color:rgb(var(--mdui-color-surface-container-highest));position:relative;overflow:hidden;box-sizing:border-box;margin:0 2px 4px}
    .row-xs-2 .col{flex:0 0 calc(50% - 4px)}
    @media (min-width:600px){.row-sm-3 .col{flex:0 0 calc(33.33333% - 4px)}}
    @media (min-width:1024px){.row-md-4 .col{flex:0 0 calc(25% - 4px)}}
    @media (min-width:1440px){.row-lg-5 .col{flex:0 0 calc(20% - 4px)}}
    mdui-list-item.col::part(container){padding: 0.35rem 0.15rem 0.35rem 0.25rem !important}
   


    
    footer{display:block;text-align:center;padding:var(--mdui-typescale-body-small-line-height);background-color:rgb(var(--mdui-color-surface-container-low));line-height:var(--mdui-typescale-body-large-line-height)}
    </style>  
    <script src="/root/file/mdui.global.js"></script>
    <script src="Valine.min.js"></script>
    <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
    <script>LA.init({id:"JMIJZqK4MvC0pOsF",ck:"JMIJZqK4MvC0pOsF"})</script>
    <script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script>
    <script>new LingQue.Monitor().init({id:"K5mJO6H2n6QPd4MK"});</script>
</head>
<body>
  <mdui-top-app-bar scroll-behavior="elevate">
    <mdui-button-icon icon="menu"></mdui-button-icon>
    <mdui-top-app-bar-title>爱莫能助</mdui-top-app-bar-title>
    <div style="flex-grow: 1"></div>
    <mdui-button-icon icon="home" href="/"></mdui-button-icon>
  </mdui-top-app-bar>
  <div id="deputy" class="mdui-prose"></div>
  <mdui-navigation-drawer close-on-overlay-click open>
    <mdui-list></mdui-list>
  </mdui-navigation-drawer>
  <mdui-layout>
    <mdui-layout-main>
      <mdui-tabs id="main" value="0"></mdui-tabs>
      <footer><p>Copyright © 2020 - <span id="FullYear">2029</span> 爱莫能助. All Rights Reserved.</p><p>本网站提供的内容信息仅供参考，不构成专业建议或承诺，用户应自行判断并承担使用风险。</p></footer>
    </mdui-layout-main>
  </mdui-layout>
<script>
document.getElementById('FullYear').textContent = (new Date().getFullYear());
const { $, breakpoint, dialog } = mdui;
const breakpointCondition = breakpoint();
// 评论
function Valinecont(el='#vcomments',config={}){const defaultConfig={appId:'u0nv0CLmlIFk7S7f7xFFYmX4-gzGzoHsz',appKey:'z27CGdACRU9SqaK38an2ie5L',avatar:'hide',...config};if(!defaultConfig.appId||!defaultConfig.appKey){console.error('Valine 初始化失败：缺少 appId 或 appKey');return null}try{const valine=new Valine({el:el,...defaultConfig});console.log('Valine 评论系统初始化成功');return valine}catch(error){console.error('Valine 初始化失败:',error);return null}}
// 初始化侧边栏抽屉行为
function initNavigationDrawer() {
  breakpointCondition.down('md') && $('mdui-navigation-drawer').attr('open', false);
  $('mdui-navigation-drawer').on('click', () => {breakpointCondition.down('md') && $('mdui-navigation-drawer').attr('open', false)});
  $('mdui-button-icon[icon="menu"]').on('click', () => $('mdui-navigation-drawer').attr('open', true));
  $('mdui-navigation-drawer').css('top', $('mdui-top-app-bar').height());
}
// 导航抽屉内容生成
function updateNavigationDrawer(index,data) {
  $('mdui-navigation-drawer mdui-list').html(data.map((group) => `<mdui-list-subheader>${group.title}</mdui-list-subheader>${group.data.map((item, itemIndex) => `<mdui-list-item href="#${index}-${itemIndex}">${item.title}</mdui-list-item>`).join('')}`).join(''));
}

// 标签页内容生成
function mduitab(data) {
  return data.map((item, index) => `<mdui-tab value="${index}">${item.title}</mdui-tab>`).join('');
}

// 面板内容生成
function mduipanel(data) {
  return data.map((group, index) => `<mdui-tab-panel slot="panel" value="${index}"><div class="mdui-prose">${panel(index,group.data)}</div></mdui-tab-panel>`).join('');
}
// 面板内部内容生成
function panel(index,data) {
return data.map((item, itemIndex) => {
return `<div class="h1" id="${index}-${itemIndex}">${item.title}</div><mdui-card><mdui-list class="row-xs-2 row-sm-3 row-md-4 row-lg-5">${item.data.map((subItem, subIndex) => {return `<mdui-list-item data-href="${index}-${itemIndex}-${subIndex}" data-src="${subItem.href}" class="col" headline-line="1" description-line="1" headline="${subItem.title}" description="${subItem.description || '- 暂无简介'}"></mdui-list-item>`;}).join('')}</mdui-list></mdui-card>`;}).join('');
}

// 初始化标签页切换事件
function initTabEvents(data) {
  const tabs = document.querySelector('mdui-tabs');
  const observer = new MutationObserver((mutations) => {updateNavigationDrawer(tabs.getAttribute('value'),[data[tabs.getAttribute('value')]])});
  observer.observe(tabs, { attributes: true, attributeFilter: ['value'] });
}

function Windowing() {
const tabser = $('#main');
const deputy = $('#deputy');
$(document).on('click', 'mdui-list-item.col', function(e) {
    const $this = $(this);
    const headline = $this.attr('headline');
    const description = $this.attr('description');
    const dataHref = $this.attr('data-href');
    const dataSrc = $this.attr('data-src');
    const path = `A2zml/#${dataHref}`;
    tabser.hide();
    $('mdui-navigation-drawer').attr('open', false);
    const Content = `<mdui-top-app-bar slot="header"><mdui-button-icon icon="close" id="close-btn"></mdui-button-icon><mdui-top-app-bar-title>${headline}</mdui-top-app-bar-title></mdui-top-app-bar>
    <div class="mdui-prose">
      <div>
        <mdui-button href="${dataSrc}" end-icon="arrow_forward">点击直达</mdui-button>
        <mdui-button target="_blank" href="${dataSrc}" end-icon="check_box_outline_blank">新窗口打开</mdui-button>
      </div>
      <p>${description}</p>
      <div class="h1">交流</div>
      <mdui-card><div id="vcomments"></div></mdui-card>
    </div>`;
    deputy.empty().append(Content);
    window.history.replaceState({}, '', `#${dataHref}`);
    Valinecont('#vcomments', {placeholder: '说点什么吧~', path: path});
});
$(document).on('click', '[icon="close"]', function(e) {
  breakpointCondition.up('md') && $('mdui-navigation-drawer').attr('open', true);
  deputy.empty();
  tabser.show();
  window.history.replaceState({}, '', '#');
});
}



// 主函数
initNavigationDrawer();
$.ajax({url: '/root/api/web/a2zml/index.json',dataType: 'json',success: function(response) {
$('mdui-tabs').append(`${mduitab(response)}${mduipanel(response)}`);
$('mdui-tab').eq(0).trigger('click');
updateNavigationDrawer(0,[response[0]]);
initTabEvents(response);
Windowing();
},error: function(xhr, status, error) {
      console.error('AJAX请求失败:', status, error);
}});
</script>
</body>
</html>
